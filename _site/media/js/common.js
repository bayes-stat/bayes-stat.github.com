function handleResponse(a,b){return function(c,d){try{var e=$.parseJSON(c);if(e!==null)switch(e.code){case 0:(a||Callbacks.showNotice)(e,undefined,d);break;case"INVALID":case"ERROR":default:(b||Callbacks.alert)(e,undefined,d)}else alert(c)}catch(f){alert(c)}}}function isImage(a,b){if(!/\.(gif|jpeg|jpg|png)$/i.test(a.value))return alert("请选择JPG/PNG/GIF类型的图片"),!1;if(a.files){var c=a.files[0];if(c.type&&!/^image\/(gif|jpeg|png)$/i.test(c.type))return alert("请选择JPG/PNG/GIF类型的图片"),!1;if(b&&c.size&&c.size>b)return alert("文件尺寸不能大于"+formatUnit(b)),!1}return!0}var $window=$(window);$.alertModal=function(a,b){var c='<div class="modal hide fade modal-alert"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3>'+(b||"提示")+"</h3></div>"+'<div class="modal-body"><p>'+a.replace(/\n/g,"<br />")+"</p></div>"+'<div class="modal-footer"><a href="#" data-dismiss="modal" class="btn primary">确定</a></div>'+"</div>";return $(c).modal({keyboard:!0,backdrop:!0})},$.fn.freeze=function(){$.each(this.find("button[type=submit]"),function(){this.disabled=!0}),$.each(this.find("input, select, textarea"),function(){this.readOnly=!0})},$.fn.unfreeze=function(){$.each(this.find("button[type=submit]"),function(){this.disabled=!1}),$.each(this.find("input, select, textarea"),function(){this.readOnly=!1})},$.fn.ajaxsubmit=function(a,b){var c=this;$.ajax({url:c.attr("action"),type:c.attr("method").toUpperCase(),data:c.serialize(),beforeSend:function(){c.freeze()},complete:function(){c.unfreeze()},success:a||Callbacks.showNotice,error:function(a,c,d){var e=$.parseJSON(a.responseText);e===null?$.alertModal(d+":"+a.responseText):(b||Callbacks.alert)(e,c,a)}})},$.fn.fileSubmit=function(a){a=$.extend({success:$.noop,error:Callbacks.alert,complete:$.noop,uploadProgress:$.noop},a);var b=this[0],c;if(typeof XMLHttpRequest=="undefined"||typeof FormData=="undefined"||(c=new XMLHttpRequest).upload===undefined){var d="hidden-iframe-"+Math.round(Math.random()*1e6);this.attr("target",d);var e=$('<iframe name="'+d+'" style="display:none;"></iframe>').insertAfter(this);b.submit(),e.load(function(b){a.complete(b);var c=(this.contentWindow||this.contentDocument).document;if(c.title){var d={"413 Request Entity Too Large":"文件尺寸过大","502 Bad Gateway":"服务器内部错误，请通知管理员","502 Bad Gateway":"服务器网关错误，请通知管理员"};alert(d[c.title]||c.title)}else handleResponse(a.success,a.error)(c.getElementsByTagName("pre")[0].innerHTML)})}else{var f=new FormData;$.each(this.serializeArray(),function(a,b){f.append(b.name,b.value)});var g=this.find("input[type=file]");f.append(g.attr("name"),g[0].files[0]),c.addEventListener("error",function(a){alert("连接不到服务器，请检查你的网络连接")},!1),c.addEventListener("load",function(b){a.complete(b);var d=b.target.status;if(d>=200&&d<300||d==304)handleResponse(a.success,a.error)(this.responseText,c);else{var e={413:"文件尺寸过大",500:"服务器内部错误，请通知管理员",502:"服务器网关错误，请通知管理员"};alert(e[d]||b.target.statusText)}},!1),$.each(["abort","loadstart","loadend","progress","timeout"],function(){a[this]&&c.addEventListener(this,a[this],!1)}),c.upload.addEventListener("progress",a.uploadProgress,!1),c.open(b.method,b.action,!0),c.setRequestHeader("Cache-Control","no-cache"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(f)}};var formatUnit=function(a){var b=["B","kB","MB","GB","TB"],c=0;while(a>=1024)c++,a/=1024;return a.toFixed(2)+b[c]};$.fn.progressbar=function(a,b){typeof a=="object"&&(b=a,a="options");var c=this.find(".progressbar-value");c.length==0&&(this.parent().find(".progress-compat").remove(),this.show(),c=$('<div class="progressbar-value ui-corner-left"></div>').appendTo(this));switch(a){case"value":var d=(b/this.data("total")*100).toFixed(0);c.toggle(b>0).toggleClass("ui-corner-right",b>=this.data("total")).width(d+"%");break;case"options":b.total&&this.data("total",b.total),c=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this);break;default:}};var Duoshuo=window.Duoshuo={timeOffset:0,serviceNames:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",netease:"网易微博",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",msn:"MSN"},serviceUrls:{weibo:"http://weibo.com/",qq:"http://www.qq.com/",qzone:"http://qzone.qq.com/",qqt:"http://t.qq.com/",renren:"http://www.renren.com/",douban:"http://www.douban.com/",netease:"http://t.163.com/",kaixin:"http://www.kaixin001.com/",sohu:"http://t.sohu.com/",baidu:"http://www.baidu.com/",msn:"http://www.live.com/"},parseDate:function(a){return a.parse("2011-10-28T00:00:00+08:00")&&function(b){return new a(b)}||a.parse("2011/10/28T00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||a.parse("2011/10/28 00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(b){return new a(b)}}(Date),fullTime:function(a){var b=Duoshuo.parseDate(a);return b.getFullYear()+"年"+(b.getMonth()+1)+"月"+b.getDate()+"日 "+b.toLocaleTimeString()},elapsedTime:function(a,b){b=b||new Date-Duoshuo.timeOffset;var c=Duoshuo.parseDate(a),d=(b-c)/1e3;return d<10?"刚刚":d<60?Math.round(d)+"秒前":d<3600?Math.round(d/60)+"分钟前":d<86400?Math.round(d/3600)+"小时前":((new Date(b)).getFullYear()==c.getFullYear()?"":c.getFullYear()+"年")+(c.getMonth()+1)+"月"+c.getDate()+"日"},expireTime:function(a){var b=Duoshuo.parseDate(a),c=new Date,d=(b-c)/1e3;return d<10?"已过期":d<60?"1分钟内过期":d<3600?Math.round(d/60)+"分钟后过期":d<86400?Math.round(d/3600)+"小时后过期":d<432e3?Math.round(d/86400)+"天后过期":"有效期至:"+(c.getFullYear()==b.getFullYear()?"":b.getFullYear()+"年")+(b.getMonth()+1)+"月"+b.getDate()+"日"}},Callbacks=window.Callbacks={alert:function(a,b,c){$.alertModal(a.errorMessage)},redirect:function(a){return function(b,c){window.location=b.response[a]}},alertMessage:function(a){var b=$('<div class="alert alert-block alert-success fade in"><a href="#" data-dismiss="alert" class="close">×</a><p></p></div>');a.code==0?($("#main .scrollable")[0].scrollTop=0,b.addClass("success").find("p").text("已保存")):b.addClass("error").find("p").text(a.message),oMain.find("post").prepend(b)},mAlertMessage:function(a){return function(){var b=$('<div class="alert alert-block alert-success fade in"><a class="close" data-dismiss="alert" href="#">&times;</a><p></p></div>');b.addClass("success").find("p").text(a),$(".content .nav-pills").after(b),window.scrollTo(0,0)}},progress:function(a,b){return function(c){var d="正在上传中："+formatUnit(c.loaded);c.lengthComputable&&(a.data("total",c.total).progressbar("value",c.loaded),d+="/"+formatUnit(c.total)),b.html(d)}}};